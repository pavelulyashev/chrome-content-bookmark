<!DOCTYPE html>

<html>
    <head>
        <script>
            var openBookmark = function() {
                var rangeInfo = localStorage.getItem('content_bookmark');
                chrome.tabs.getSelected(null, function(tab) {
                    chrome.tabs.sendRequest(tab.id, {
                        action: 'highlightSelection',
                        rangeInfo: rangeInfo
                    });
                });
                return false;
            };
			function CollapseExpand(index)
			{
				var content = document.getElementById("text"+index);
				var button = document.getElementById("button"+index);
				if(button.value == "+")
				{
					button.value = "-";
					content.style.display='';
				}
				else
				{
					button.value = "+";
					content.style.display='none';
				}
			}
			
			function ClearStorage()
			{
				localStorage.clear()
				 chrome.browserAction.setBadgeText({ 
					"text": '0'
				}); 
				history.go(0);
			}
        </script>
    </head>
    <body>
        <div>
            <a href="#" onclick="return openBookmark()">Bookmark</a>
			<table width="400px">
					<script>
						for (var i = 0; i < localStorage.length; i++) {
							var obj = JSON.parse(localStorage[i]);
							var title = obj.title;
							if(obj.title.length > 40)
							{
								title = title.substr(0,40)+"...";
							}
							document.writeln("<tr><td><input style='width: 23px' type='button' value='+' onClick='CollapseExpand("+i+")' id='button"+i+"'></input>   <a href = \"" + obj.url + "\" target=\"_blank\" title="+ obj.title + ">" + title + "</a></td></tr>");	
							document.writeln("<tr id='text"+i+"' style='display:none'><td><a>" + obj.selectionText + "</a></td></tr>");
						}
					</script>
			</table>
			<input type='button' value='clear!' onClick='ClearStorage()'></input>
        </div>
    </body>
</html>
