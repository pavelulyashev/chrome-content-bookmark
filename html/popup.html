<!DOCTYPE html>

<html>
    <head>
        <script>
            var openBookmark = function(index) {
                var bookmark = JSON.parse(localStorage[index]);

                chrome.tabs.create({url: bookmark.url}, function(tab) {
                    chrome.tabs.sendRequest(tab.id, {
                        action: 'highlightSelection',
                        rangeInfo: bookmark.rangeInfo
                    });
                });
                return false;
            };
			var link_template = '<li><a class="bookmark_link" href="_url_" ' + 
			                    'onclick="return openBookmark(_index_);">_title_</a></li>';

			function CollapseExpand(index)
			{
				var content = document.getElementById("text"+index);
				var button = document.getElementById("button"+index);
				if(button.value == "+")
				{
					button.value = "-";
					content.style.display='';
				}
				else
				{
					button.value = "+";
					content.style.display='none';
				}
			}
			
			function clearStorage() {
				localStorage.clear()
				chrome.browserAction.setBadgeText({ 
					"text": '0'
				}); 
				history.go(0);
			}
        </script>
    </head>
    <body>
        <!--script>
            var toWrite = ['<ul id="links_list" style="width: 400px">'];
            for (var i = 0; i < localStorage.length; i++) {
                var obj = JSON.parse(localStorage[i]);
                var title = obj.title;
                if (obj.title.length > 50)
                    title = title.substr(0, 50) + "...";
                
                var li = link_template.replace('_url_', obj.url)
                                      .replace('_index_', i)
                                      .replace('_title_', title);
                toWrite.push(li);
            }
            toWrite.push('</ul>');
            document.writeln(toWrite.join(''));
        </script-->
        <table width="400px">
                <script>
                    for (var i = 0; i < localStorage.length; i++) {
                        var obj = JSON.parse(localStorage[i]);
                        var title = obj.title;
                        if(obj.title.length > 40)
                        {
                            title = title.substr(0,40)+"...";
                        }
                        document.writeln("<tr><td><input style='width: 23px' type='button' value='+' onClick='CollapseExpand("+i+")' id='button"+i+"'></input>   <a href = \"" + obj.url + "\" target=\"_blank\" onclick=\"return openBookmark(" + i + ");\" title="+ obj.title + ">" + title + "</a></td></tr>");	
                        document.writeln("<tr id='text"+i+"' style='display:none'><td><a>" + obj.selectionText + "</a></td></tr>");
                    }
                </script>
        </table>
        <input type='button' value='clear!' onClick='clearStorage()'></input>
    </body>
</html>
