<!DOCTYPE html>

<html>
    <head>
        <script>
            var openBookmark = function(index) {
                var bookmark = JSON.parse(localStorage[index]);

                chrome.tabs.create({url: bookmark.url}, function(tab) {
                    chrome.tabs.sendRequest(tab.id, {
                        action: 'highlightSelection',
                        rangeInfo: bookmark.rangeInfo
                    });
                });
                return false;
            };

			var link_template = '<li><a class="bookmark_link" href="_url_" ' + 
			                    'onclick="return openBookmark(_index_);">_title_</a></li>';
        </script>
    </head>
    <body>
        <div>
            <script>
                var toWrite = ['<ul id="links_list" style="width: 400px">'];
				for (var i = 0; i < localStorage.length; i++) {
                    var obj = JSON.parse(localStorage[i]);
                    var title = obj.title;
                    if (obj.title.length > 50)
                        title = title.substr(0, 50) + "...";
                    
                    var li = link_template.replace('_url_', obj.url)
                                          .replace('_index_', i)
                                          .replace('_title_', title);
                    toWrite.push(li);
                }
                toWrite.push('</ul>');
                document.writeln(toWrite.join(''));
            </script>
        </div>
    </body>
</html>
